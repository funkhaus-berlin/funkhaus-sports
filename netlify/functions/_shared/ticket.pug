doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Booking Confirmation
    style.
      body {
        font-family: Arial, sans-serif;
        line-height: 1.5;
        color: #000;
        background-color: #fff;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }
      .header {
        text-align: center;
        padding-bottom: 20px;
        border-bottom: 1px solid #000;
        margin-bottom: 20px;
      }
      .logo {
        max-width: 120px;
        height: auto;
      }
      h1 {
        font-size: 20px;
        margin-top: 15px;
      }
      h2 {
        font-size: 16px;
        margin-top: 20px;
        margin-bottom: 10px;
        border-bottom: 1px solid #000;
        padding-bottom: 5px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      table tr td {
        padding: 8px 0;
      }
      .label {
        font-weight: bold;
        width: 40%;
      }
      .footer {
        margin-top: 30px;
        text-align: center;
        padding-top: 20px;
        border-top: 1px solid #000;
        font-size: 14px;
      }
      .button {
        display: inline-block;
        background-color: #000;
        color: white;
        padding: 8px 15px;
        text-decoration: none;
        margin-top: 15px;
      }

  body
    div.container
      div.header
        img.logo(src="https://funkhausevents.netlify.app/logo.png" alt="Funkhaus Sports Logo")
        h1 Booking Confirmation

      p Hi #{customer.name},
      
      p Your court reservation has been confirmed.
      
      h2 Court Details
      table
        tr
          td.label Court:
          td #{booking.court}
        tr
          td.label Venue:
          td #{booking.venue}
        if venue && venue.address
          tr
            td.label Address:
            td #{venue.address.street}, #{venue.address.city}, #{venue.address.postalCode}, #{venue.address.country}
              
      h2 Booking Details
      table
        tr
          td.label Date:
          td #{booking.date}
        tr
          td.label Time:
          td #{booking.startTime} - #{booking.endTime}
        tr
          td.label Total Price:
          td ‚Ç¨#{booking.price}
          
      h2 Your Event
      //- Email-safe calendar preview using tables
      table(cellpadding="0" cellspacing="0" border="0" style="width: 100%; max-width: 600px; margin: 20px 0; background-color: #f8f8f8; border-left: 4px solid #000; border-radius: 4px;")
        tr
          td(style="padding: 20px;")
            //- Date Column (Left side)
            table(cellpadding="0" cellspacing="0" border="0" style="float: left; text-align: center; padding-right: 15px; margin-right: 15px; border-right: 1px solid #ddd; min-width: 60px;")
              tr
                //- Use hardcoded date for reliability
                - var month = 'MAY';
                - var day = '10';
                - var year = '2025';
                td(style="text-transform: uppercase; font-size: 14px; font-weight: bold; color: #000; font-family: Arial, sans-serif;")= month
              tr
                td(style="font-size: 24px; font-weight: bold; line-height: 1; margin: 5px 0; font-family: Arial, sans-serif;")= day
              tr
                td(style="font-size: 14px; color: #666; font-family: Arial, sans-serif;")= year
            
            //- Event Details (Right side)
            table(cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, sans-serif;")
              tr
                td(style="font-weight: bold; margin-bottom: 10px; font-size: 16px; font-family: Arial, sans-serif;")
                  | üéæ Court Booking: #{booking.court}
              tr
                td(style="font-weight: bold; margin-bottom: 8px; font-size: 14px; font-family: Arial, sans-serif;")
                  | ‚è∞ #{booking.startTime} - #{booking.endTime}
              tr
                td(style="color: #666; font-size: 14px; font-family: Arial, sans-serif;")
                  | üìç #{booking.venue}
                  
      //- We've attached the calendar details section
      p We've attached a calendar file (.ics) to this email that you can add to your calendar.
      
      //- Add to Calendar buttons
      h2 Add to Calendar
      
      //- Calendar button styles
      style.
        .calendar-btn {
          display: inline-block;
          background-color: #000;
          color: white !important;
          padding: 8px 15px;
          margin: 5px;
          text-decoration: none;
          border-radius: 4px;
          font-family: Arial, sans-serif;
        }
        .google-btn {
          background-color: #4285F4;
        }
        .outlook-btn {
          background-color: #0078D4;
        }
        .apple-btn {
          background-color: #000;
        }
      
      //- Use simpler date handling to avoid template parsing issues
      - var eventTitle = encodeURIComponent('Court Booking: ' + booking.court);
      - var details = encodeURIComponent('Your court booking at ' + booking.venue + '. Booking ID: ' + (typeof bookingId !== 'undefined' ? bookingId : ''));
      - var location = encodeURIComponent(booking.venue);
      
      //- Default calendar dates in case parsing fails
      - var startTimeStr = '20250510T170000Z';
      - var endTimeStr = '20250510T173000Z';
      
      
      //- Calendar link container
      div(style="text-align: center; margin: 20px 0;")
        //- Google Calendar button
        a.calendar-btn.google-btn(href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Court%20Booking&dates=20250510T170000Z/20250510T173000Z&details=Your%20booking%20details&location=Funkhaus%20Sports&sf=true&output=xml", target="_blank")
          | Google Calendar
        
        //- Outlook Calendar button
        a.calendar-btn.outlook-btn(href="https://outlook.office.com/calendar/0/deeplink/compose?subject=Court%20Booking&body=Your%20booking%20details&location=Funkhaus%20Sports", target="_blank")
          | Outlook Calendar
        
        //- Apple Calendar button
        a.calendar-btn.apple-btn(href="#", style="background-color:#000;")
          | Apple Calendar (Use Attachment)
          
      p(style="text-align: center; color: #666; font-size: 14px; margin-top: 5px;")
        | Simply open the attached calendar file (.ics) to add this event to your calendar.


      div.footer
        p Questions? Contact: 
        if venue && venue.contactEmail
          a(href=`mailto:${venue.contactEmail}`) #{venue.contactEmail}
        else
          a(href="mailto:booking@funkhaus-sports.com") booking@funkhaus-sports.com
        
        if venue && venue.contactPhone
          p Phone: #{venue.contactPhone}
